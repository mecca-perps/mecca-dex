const convertDateToSimpleFormat = (dateString) => {
    const date = new Date(dateString);

    const year = date.getUTCFullYear();
    const month = String(date.getUTCMonth() + 1).padStart(2, '0');;
    const day = String(date.getUTCDate()).padStart(2, '0');

    return `${year}-${month}-${day}`;
}

const processOHLCData = (array) => {
    const ohlcData = array.map(d => ({
        time: convertDateToSimpleFormat(d[0]),
        open: d[1],
        high: d[2],
        low: d[3],
        close: d[4],
    }));
    
    return ohlcData;
}

export const fetchOHLCData = async () => {
    const response = await fetch('https://api.coingecko.com/api/v3/coins/ethereum/ohlc?vs_currency=usd&days=365');
    const data = await response.json();
    // const data = [[1719563400000,3431.55,3431.55,3422.92,3430.44],[1719565200000,3431.53,3432.82,3425.82,3429.55],[1719567000000,3435.39,3435.39,3430.18,3430.83],[1719568800000,3431.14,3441.01,3430.69,3441.01],[1719570600000,3437.21,3441.49,3435.31,3441.49],[1719572400000,3441.91,3443.78,3440.76,3440.76],[1719574200000,3441.44,3454.58,3438.45,3450.73],[1719576000000,3453.44,3453.44,3447.75,3447.75],[1719577800000,3451.59,3455.95,3450.84,3455.95],[1719579600000,3457.84,3459.32,3439.0,3439.0],[1719581400000,3437.61,3441.66,3432.13,3441.66],[1719583200000,3444.39,3461.39,3439.46,3453.18],[1719585000000,3436.57,3455.09,3430.54,3430.54],[1719586800000,3429.03,3429.03,3404.32,3404.32],[1719588600000,3408.08,3409.51,3400.57,3409.51],[1719590400000,3411.92,3411.92,3407.11,3407.11],[1719592200000,3410.46,3410.46,3397.29,3397.29],[1719594000000,3400.26,3401.22,3380.68,3387.48],[1719595800000,3391.25,3394.84,3385.96,3394.84],[1719597600000,3392.13,3392.13,3377.95,3377.95],[1719599400000,3378.96,3384.16,3377.64,3377.64],[1719601200000,3378.96,3381.44,3378.76,3380.04],[1719603000000,3378.74,3378.74,3359.85,3374.85],[1719604800000,3369.58,3376.05,3369.58,3370.75],[1719606600000,3370.62,3386.74,3370.62,3385.76],[1719608400000,3384.48,3387.47,3380.62,3381.55],[1719610200000,3382.75,3383.06,3372.96,3375.93],[1719612000000,3375.97,3378.54,3375.97,3378.54],[1719613800000,3377.17,3377.33,3366.64,3366.64],[1719615600000,3365.66,3369.2,3364.24,3368.3],[1719617400000,3368.09,3369.81,3366.69,3369.81],[1719619200000,3370.92,3375.72,3370.92,3374.61],[1719621000000,3373.61,3382.33,3373.61,3378.11],[1719622800000,3379.04,3382.18,3376.99,3380.59],[1719624600000,3387.64,3391.01,3383.55,3384.64],[1719626400000,3385.34,3392.15,3385.34,3388.85],[1719628200000,3389.8,3392.91,3385.38,3387.52],[1719630000000,3385.74,3385.74,3381.23,3381.23],[1719631800000,3385.17,3385.17,3380.18,3380.18],[1719633600000,3382.2,3382.88,3380.09,3381.11],[1719635400000,3380.31,3380.41,3378.63,3379.52],[1719637200000,3378.88,3385.38,3378.88,3385.14],[1719639000000,3383.43,3384.49,3381.07,3381.07],[1719640800000,3381.26,3381.26,3376.37,3380.39],[1719642600000,3381.25,3381.76,3378.67,3379.98],[1719644400000,3379.96,3384.87,3379.96,3382.21],[1719646200000,3383.27,3391.79,3383.27,3391.79],[1719648000000,3394.67,3400.42,3394.67,3396.67]];

    const ohlcData = await processOHLCData(data);
    return ohlcData;
}